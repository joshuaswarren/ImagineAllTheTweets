!function(a){function b(){var b=c(this);return isNaN(b.datetime)||a(this).text(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return d(b instanceof Date?b:"string"==typeof b?a.timeago.parse(b):"number"==typeof b?new Date(b):a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}var d=this.settings.strings,e=d.prefixAgo,f=d.suffixAgo;this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow);var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=void 0===d.wordSeparator?" ":d.wordSeparator;return a.trim([e,l,f].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(c)},datetime:function(b){var c=a(b).attr(f.isTime(b)?"datetime":"title");return f.parse(c)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}}),a.fn.timeago=function(){var a=this;a.each(b);var c=f.settings;return c.refreshMillis>0&&setInterval(function(){a.each(b)},c.refreshMillis),a},document.createElement("abbr"),document.createElement("time")}(jQuery),function(a,b){"use strict";function c(a){return a=a.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(a){var b=a;return b.match("^https?://")||(b="http://"+b),'<a href="'+b+'" target="_blank">'+a+"</a>"})}function d(a,b,c,d,e,f){google.maps.OverlayView.apply(this,arguments),this.position=a,this.content=b,this.width=c||260,this.height=d||260,this.shadowImg=e||"",this.shadowHeight=f||100,this.loaded=!1}function e(b,c){this.element=b,this.options=a.extend({},m,c),this.twitterOptions={q:this.options.q,geocode:this.options.geocode,result_type:this.options.result_type,rpp:this.options.rpp,until:this.options.until,since_id:this.options.since_id,max_id:this.options.max_id,include_entities:this.options.include_entities},this.mapElem=a(this.element)[0],this.mapType=j(this.options.maptype),this.mapOptions={zoom:this.options.zoom,center:new google.maps.LatLng(this.options.latitude,this.options.longitude),mapTypeId:this.mapType},this.refresh(),this.init()}d.prototype=new google.maps.OverlayView,d.prototype.constructor=d,d.prototype.onAdd=function(){this.container=a('<div class="gmap-bubble"></div>'),this.getPanes().floatPane.appendChild(this.container[0]),this.shadowImg&&(this.shadow=a('<div class="tweetmap-shadow"></div>'),this.shadow.css("position","absolute"),this.getPanes().floatShadow.appendChild(this.shadow[0])),this.container.css("position","absolute"),this.container.height(this.height),this.container.width(this.width),this.container.append('<div class="tweetmap-loading"></div>'),this.contentContainer=a('<div class="tweetmap-panel"></div>'),this.container.append(this.contentContainer),this.container.append('<div class="tweetmap-pointer">â–²</div><div class="tweetmap-close"><a href="#">x</a></div>');var b=this,c=function(a){a.preventDefault(),b.setMap(null)};a(".tweetmap-close > a",this.container).click(c)},d.prototype.draw=function(){this.loaded||this.contentContainer.append(this.content),a(".timeago",this.container).timeago();var b=this.getPoint();this.container.css("left",b.x-30+"px"),this.container.css("top",b.y+14+"px"),this.shadow&&(this.shadow.css("left",b.x-18+"px"),this.shadow.css("top",b.y-this.shadowHeight-8+"px")),this.loaded||(this.panMap(),this.loaded=!0)},d.prototype.show=function(){this.container.css("visibility","visible")},d.prototype.hide=function(){this.container.css("visibility","hidden")},d.prototype.onRemove=function(){this.contentContainer.remove(),this.contentContainer=null,this.container.remove(),this.container=null},d.prototype.panMap=function(){var a=this.getPoint();this.getMap().panTo(this.getProjection().fromDivPixelToLatLng(new google.maps.Point(a.x+this.width/2,a.y-this.height/2+200)))},d.prototype.getPoint=function(){return this.getProjection().fromLatLngToDivPixel(this.position)};var f=function(b){if(!b||!b.q)return!1;var c=[];return a.each(b,function(a,b){b&&(b=b.replace(/\s*/g,""),c.push(a+"="+encodeURIComponent(b)))}),"tweetmap/twitter/proxy.php?"+c.join("&")+"&callback=?"},g=function(b,e,f,g){a(g).append('<div class="tweetmap-mapLoading">Loading Tweets...</div>');var h=[];return a.getJSON(b,function(b){return 0===b.length?(console.error&&console.error("We have no location data"),!1):(a.each(b,function(b,g){if(g.geo){var i,j=new google.maps.LatLng(g.geo.coordinates[0],g.geo.coordinates[1]),k=new google.maps.MarkerImage(e.marker,null,null,null,new google.maps.Size(50,50)),l=new google.maps.Marker({icon:k,position:j,map:f,optimized:!1}),m="",n="";g.entities.media&&g.entities.media[0].media_url_https&&(m='<img src="'+g.entities.media[0].media_url_https+':small" class="tweetImage" />'),g.text&&(n=c(g.text)),i=function(){a(".gmap-bubble").remove();var b=new d(j,m+'<span class="tweetText">'+n+'</span><span class="tweetTime timeago" title="'+g.created_at+'"></span>',e.windowwidth,e.windowheight);b.setMap(l.getMap())},h.push(l),google.maps.event.addListener(l,"click",i)}}),a(".tweetmap-mapLoading",g).remove(),a(g).trigger("markersLoaded"),h)}),h},h=function(b,c){b.customMarkers&&a.each(b.customMarkers,function(e,f){var g,h=new google.maps.LatLng(f.latitude,f.longitude),i=new google.maps.MarkerImage(b.marker,null,null,null,new google.maps.Size(50,50)),j=new google.maps.Marker({icon:i,position:h,map:c,optimized:!1});g=function(){a(".gmap-bubble").remove();var c=new d(h,f.html,b.windowwidth,b.windowheight);c.setMap(j.getMap())},google.maps.event.addListener(j,"click",g)})},i=function(a){if(a.feed)for(var b=a.feed,c=0;c<b.length;c+=1)b[c].setMap(null),c===b.length-1&&k(a)},j=function(a){switch(a){case"ROADMAP":return google.maps.MapTypeId.ROADMAP;case"SATELLITE":return google.maps.MapTypeId.SATELLITE;case"HYBRID":return google.maps.MapTypeId.HYBRID;case"TERRAIN":return google.maps.MapTypeId.TERRAIN;default:return google.maps.MapTypeId.ROADMAP}},k=function(a){a.url=f(a.twitterOptions),a.feed=g(a.url,a.options,a.map,a.mapElem),n(a.options.customMarkers)||h(a.options,a.map),console.log&&console.log(a.url)},l="tweetMap",m=(b.document,{latitude:"",longitude:"",zoom:11,marker:"tweetmap/marker.png",maptype:"ROADMAP",windowheight:"",windowwidth:"",q:"",geocode:"",result_type:"recent",rpp:"100",until:"",since_id:"",max_id:"",include_entities:"true",customMarkers:{}}),n=function(a){return 0===Object.keys(a).length};e.prototype.refresh=function(){var b=a(this).data("plugin_"+l);b&&i(b)},e.prototype.init=function(){var a=this;this.map=new google.maps.Map(this.mapElem,this.mapOptions),google.maps.event.addListenerOnce(this.map,"idle",function(){k(a)})},a.fn[l]=function(b){return this.each(function(){var c=a(this).data("plugin_"+l);a.data(this,"plugin_"+l)||a.data(this,"plugin_"+l,new e(this,b)),"string"==typeof b&&c[b].call(this)})}}(jQuery,window);